@using HalloDocService.ViewModels;
@model PartnerViewModel;
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@{
    ViewData["Title"] = "Partner Page";
    Layout = "~/Views/Shared/_AdminDashboard.cshtml";
}

<main class="Partner-Section container-sm mt-sm-5 mb-3">
    <div class="d-flex mt-4">
        <h4 class="fw-bold">Vendor(s)</h4>
    </div>
    <div class="p-4 mt-3 mb-3 rounded shadow border">
        <div id="partner-header" class="d-flex justify-content-between flex-wrap align-items-center gap-2">
            <div class="d-flex gap-3">
                <div class="form-group has-search">
                    <span class="fa fa-search form-control-feedback"></span>
                    <input type="text" id="searchKeyword" class="form-control" placeholder="Search Vendors"
                        oninput="debounce(searchByVendor, 500)">
                </div>
                <div class="form-group has-search">
                    <span class="fa fa-search form-control-feedback"></span>
                    <select class="form-control form-select" id="professionDropdown" onchange="sortProfession()">
                        <option value="0" selected>All Profession</option>
                        @foreach (var item in Model.AllProfessionsList)
                        {
                            <option value="@item.ProfessionId">@item.ProfessionName</option>
                        }
                    </select>
                </div>
            </div>
            <div class="d-flex gap-2 flex-wrap">
                <a class="btn theme-btn" asp-area="admin" asp-controller="Partner" asp-action="Create"> <i
                        class="fa-solid fa-plus"></i> Add Business</a>
            </div>
        </div>
        <div id="PartnerTable-body" class="mt-3">
            <partial name="_PartnerTable" />
        </div>
    </div>
</main>

@* Confirmation Delete Modal *@
<div class="modal fade shadow-lg " id="deleteVendorConfirmation" tabindex="-1" aria-labelledby="exampleModalLabel"
    aria-hidden="true">

</div>


<script>
    $("#adminDashTab li").each(function () {
        if ($(this).data("id") == 5) {
            $("#adminDashTab li a").removeClass("active");
            $(this).addClass("active").find("a").addClass("active");
            $(this).find(".inner-nav ul li a").removeClass("active");
            $(this).find(".inner-nav ul li[data-inner-itemid='4'] a").addClass("active");
        }
    })
</script>

<script>
    let professionId = 0;
    let timeoutId;

    function debounce(func, delay) {
        clearTimeout(timeoutId);
        timeoutId = setTimeout(func, delay);
    }
    function searchByVendor() {
        searchKeyword = document.getElementById("searchKeyword").value.toLowerCase();
        sendAjaxRequest('/admin/partner/Index', 'POST', { vendorName: searchKeyword, professionId }, "application/x-www-form-urlencoded; charset=UTF-8", true)
            .then(function (response) {
                $("#PartnerTable-body").empty();
                $("#PartnerTable-body").html(response);
            }).catch(function (error) {
                ToastError("Internal Server Error");
            })
    }
    function sortProfession() {
        $("#searchKeyword").val("");
        professionId = $("#professionDropdown").val();
        sendAjaxRequest('/admin/partner/Index', 'POST', { vendorName: "", professionId }, "application/x-www-form-urlencoded; charset=UTF-8", true)
            .then(function (response) {
                $("#PartnerTable-body").empty();
                $("#PartnerTable-body").html(response);
            }).catch(function (error) {
                ToastError("Internal Server Error");
            })
    }

    function deleteConfirmModal(vendorId) {
        let modal = document.getElementById("deleteVendorConfirmation");
        modal.innerHTML = `
            <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header" style="background-color: #01bce9;">
                <h1 class="modal-title fs-5 text-light" id="exampleModalLabel">Confirm Deletion</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form action="/admin/partner/Delete" method="post" id="contactForm">
            <div class="modal-body">
                <input type="hidden" name="id" value="${vendorId}">
                <p class="text-muted fw-bold"> Are you sure you want to delete this vendor business? </p>
            </div>
            <div class="modal-footer">
                <button type="submit" id="submitBtn" class="btn btn-danger">Confirm</button>
                <button type="button" class="btn theme-btn" data-bs-dismiss="modal">Cancle</button>
            </div>
            </form>
        </div>
    </div>
        `;
        let modalInstance = new bootstrap.Modal(modal);
        modalInstance.show();
    }

</script>
