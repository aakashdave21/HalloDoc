@using HalloDocService.ViewModels;
@model AdminAccessEditViewModel;
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@{
    ViewData["Title"] = "Access Edit Page";
    Layout = "~/Views/Shared/_AdminDashboard.cshtml";
}

<main class="Access-Edit-Section container-sm mt-sm-5">
    <div class="d-flex justify-content-end mt-4">
        <a asp-area="Admin" asp-controller="Access" asp-action="Index" class="btn btn-sm back-link"><i
                class="fa-solid fa-chevron-left"></i> Back</a>
    </div>
    <div class="d-flex mt-4">
        <h4 class="fw-bold">Edit Role</h4>
    </div>
    <div class="p-4 mt-3 mb-3 rounded shadow border">
        <div id="Access-create-body">
            <h6 class="fw-bold">Details</h6>
        </div>
        <form asp-area="admin" asp-controller="Access" asp-action="EditPost" method="post" id="UpdateAccessForm">
            <div class="role-input">
                <div class="row">
                    <input type="hidden" name="Id" id="roleId" asp-for="Id"/>
                    <div class="col-md-6 mb-3">
                        <div class="form-floating">
                            <input asp-for="Role" type="text" class="form-control" id="rolename"
                                placeholder="rolename">
                            <label asp-for="Role" for="rolename">Role Name</label>
                        </div>
                        <span id="role-valid" class="text-danger"></span>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="form-floating ">
                            <select asp-for="AccountType" class="form-select mb-3" aria-label="Large select example" name="accountType"
                                id="accountType" placeholder="accountType" onchange="getMenuByAccountType()">
                                @* <option selected value="0" disabled>All</option> *@
                                <option value="1">Admin</option>
                                <option value="2">Physician</option>
                            </select>
                            <label asp-for="AccountType" for="accountType">Account Type</label>
                        </div>
                    </div>
                </div>
            </div>
            <div id="MenuItems">
                <partial name="_MenuList" />
            </div>
            <div class="d-flex justify-content-end gap-2">
                <button type="button" class="btn secondary-theme-btn" onclick="UpdateRole()">Save</button>
                <button type="reset" class="btn theme-btn">Cancel</button>
            </div>
        </form>
    </div>
</main>


<script>
    function getMenuByAccountType() {
        let accountTypeValue = $("#accountType").val();
        let roleId = $("#roleId").val();
        sendAjaxRequest('/admin/access/getMenuByAccountType', 'POST', { accountId: accountTypeValue, roleId:roleId }, "application/x-www-form-urlencoded; charset=UTF-8", true)
            .then(function (response) {
                $("#MenuItems").empty();
                $("#MenuItems").append(response);
            }).catch(function (error) {
                ToastError("Internal Server Error");
            })
    }

    
    function UpdateRole(){
        if ($("#rolename").val().trim() === "") {
            $("#role-valid").text("Role Name is required.");
            return;
        }
        let selectedMenus = [];
        let unselectedMenus = [];
        $(".selectedMenu").each(function () {
            if (!$(this).prop('checked')) {
                unselectedMenus.push($(this).val());
            }
        });
        $(".UnselectedMenu").each(function () {
            if ($(this).prop('checked')) {
                selectedMenus.push($(this).val());
            }
        });
        $("#UpdateAccessForm").append('<input type="hidden" name="selectedMenus" value="' + selectedMenus.join(',') + '">');
        $("#UpdateAccessForm").append('<input type="hidden" name="unselectedMenus" value="' + unselectedMenus.join(',') + '">');
        $("#UpdateAccessForm").submit();
    }
</script>

<script>
    $("#adminDashTab li").each(function(){
        if($(this).data("id")==6){
            $("#adminDashTab li a").removeClass("active");
            $(this).addClass("active").find("a").addClass("active");
        }
    })
</script>