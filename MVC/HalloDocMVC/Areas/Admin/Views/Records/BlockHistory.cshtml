@using HalloDocService.ViewModels;
@model RecordsViewModel;
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@{
    ViewData["Title"] = "Block History Page";
    Layout = "~/Views/Shared/_AdminDashboard.cshtml";
}
<style>
    table thead th {
        background: transparent !important;
    }
    table thead tr {
        background: rgba(97, 97, 97, 0.301);
    }
    table tbody tr:hover {
        background: rgba(156, 232, 255, 0.103);
        cursor: default;
    }
</style>
<main class="block-Section container-fluid p-md-5 mt-sm-5 mt-2 mb-3">
    <div class="d-flex">
        <h4 class="fw-bold">Block History</h4>
    </div>
    <div class="p-4 mt-3 mb-3 rounded shadow border">
        <div id="block-header">
            <form>
                <div class="row g-2">
                    <div class="col-md-3 col-sm-6">
                        <div class="form-floating ">
                            <input type="text" class="form-control" id="Name" placeholder="Name">
                            <label for="Name">Name</label>
                        </div>
                    </div>
                     <div class="col-md-3 col-sm-6">
                        <div class="form-floating ">
                            <input type="date" class="form-control" id="Date" placeholder="Date">
                            <label for="Date">Date</label>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-6">
                        <div class="form-floating ">
                            <input type="text" class="form-control" id="email" placeholder="email">
                            <label for="email">Email</label>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-6">
                        <div class="form-floating ">
                            <input type="text" class="form-control" id="phone" placeholder="phone">
                            <label for="phone">Phone Number</label>
                        </div>
                    </div>
                </div>
                <div class="d-flex justify-content-end gap-2 mt-3">
                    <button type="reset" class="btn theme-btn" onclick="clearFilter()">Clear</button>
                    <button type="button" class="btn secondary-theme-btn" onclick="searchRecords()">Search</button>
                </div>
            </form>
        </div>
        <div id="blockHistory-render" class="mt-3">
            <partial name="_blockHistoryTable" />
        </div>
    </div>
</main>

@* Confirmation Delete Modal *@
<div class="modal fade shadow-lg " id="unblockRequestModal" tabindex="-1" aria-labelledby="exampleModalLabel"
    aria-hidden="true">

</div>

<script>
    let pageSize = 5;
    let pageNum = 1;
    let SearchBy = {
        phoneNumber : "",
        patientName : "",
        email : 0,
        createdDate : "",
    }

    const searchRecords = () => {
        getData();
        CallAjax();
    }

    function RecordsPageChange() {
        getData();
        const pageChange = document.querySelector(".RecordsPageChange");
        pageNum = pageChange.value;
        CallAjax();
    }

    function pageRecordChange() {
        pageNum = 1;
        getData();
        const pageRecordChange = document.querySelector(".ReqRecordsPageRecordChange").value;
        pageSize = pageRecordChange
        CallAjax();
    }

    function clearFilter() {
        pageNum = 1;
        pageSize = 5;
        SearchBy = {
            phoneNumber : "",
            patientName : "",
            email : "",
            createdDate : "",
        }
        CallAjax();
    }

    function CallAjax() {
        sendAjaxRequest('/admin/records/BlockHistory', 'GET', { pageSize, pageNum, ...SearchBy }, "application/x-www-form-urlencoded; charset=UTF-8", true)
            .then(function (response) {
                $("#blockHistory-render").empty();
                $("#blockHistory-render").html(response);
            }).catch(function (error) {
                ToastError("Internal Server Error");
            })
    }

    function getData() {
       SearchBy.phoneNumber = $("#phone").val();
       SearchBy.patientName = $("#Name").val();
       SearchBy.email = $("#email").val();
       SearchBy.createdDate = $("#Date").val();
    }

    function openUnblockModal(reqId) {
        let modal = document.getElementById("unblockRequestModal");
        modal.innerHTML = `
            <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header" style="background-color: #01bce9;">
                <h1 class="modal-title fs-5 text-light" id="exampleModalLabel">Confirm Unblock</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form action="/admin/Records/Unblock" method="post" id="contactForm">
            <div class="modal-body">
                <input type="hidden" name="id" value="${reqId}">
                <p class="text-muted fw-bold"> Are you sure you want to Unblock this Request? </p>
            </div>
            <div class="modal-footer">
                <button type="submit" id="submitBtn" class="btn secondary-theme-btn">Confirm</button>
                <button type="button" class="btn theme-btn" data-bs-dismiss="modal">Cancle</button>
            </div>
            </form>
        </div>
    </div>
        `;
        let modalInstance = new bootstrap.Modal(modal);
        modalInstance.show();
    }
</script>
<script>
    $("#adminDashTab li").each(function(){
        if($(this).data("id")==7){
            $("#adminDashTab li a").removeClass("active");
            $(this).addClass("active").find("a").addClass("active");
            $(this).find(".inner-nav ul li a").removeClass("active");
            $(this).find(".inner-nav ul li[data-inner-itemid='12'] a").addClass("active");
            $(this).find(".showMenu").html(`Blocked History <i class="fa-solid fa-caret-down"></i>`);
        }
    })
</script>