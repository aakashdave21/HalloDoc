@using HalloDocService.ViewModels;
@model RecordsViewModel;
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@{
    ViewData["Title"] = "Patient History Page";
    Layout = "~/Views/Shared/_AdminDashboard.cshtml";
}
<style>
    table thead th {
        background: transparent !important;
    }
    table thead tr {
        background: rgba(97, 97, 97, 0.301);
    }
    table tbody tr:hover {
        background: rgba(156, 232, 255, 0.103);
        cursor: default;
    }
</style>
<main class="Partner-Section container-fluid p-md-5 mt-sm-5 mb-3">
    <div class="d-flex mt-4">
        <h4 class="fw-bold">Patient History</h4>
    </div>
    <div class="p-4 mt-3 mb-3 rounded shadow border">
        <div id="partner-header">
            <form>
                <div class="row g-2">
                    <div class="col-md-3 col-sm-6">
                        <div class="form-floating ">
                            <input type="text" class="form-control" id="fname" placeholder="first name">
                            <label for="fname">First Name</label>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-6">
                        <div class="form-floating ">
                            <input type="text" class="form-control" id="lname" placeholder="Last name">
                            <label for="lname">Last Name</label>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-6">
                        <div class="form-floating ">
                            <input type="text" class="form-control" id="email" placeholder="email">
                            <label for="email">Email</label>
                        </div>
                    </div>
                    <div class="col-md-3 col-sm-6">
                        <div class="form-floating ">
                            <input type="text" class="form-control" id="phone" placeholder="phone">
                            <label for="phone">Phone Number</label>
                        </div>
                    </div>
                </div>
                <div class="d-flex justify-content-end gap-2 mt-3">
                    <button type="reset" class="btn theme-btn" onclick="clearFilter()">Clear</button>
                    <button type="button" class="btn secondary-theme-btn" onclick="searchPatient()">Search</button>
                </div>
            </form>
        </div>
        <div id="patientHistory-render" class="mt-3">
            <partial name="_PatientHistoryTable" />
        </div>
    </div>
</main>

<script>
    let pageSize = 5;
    let pageNum = 1;
    let firstname = "";
    let lastname = "";
    let email = "";
    let phoneNumber = "";
    const searchPatient = () => {
        firstname = $("#fname").val().toLowerCase();
        lastname = $("#lname").val().toLowerCase();
        email = $("#email").val().toLowerCase();
        phoneNumber = $("#phone").val().toLowerCase();
        CallAjax();
    }

    function PatientHistoryPageChange() {
        firstname = $("#fname").val().toLowerCase();
        lastname = $("#lname").val().toLowerCase();
        email = $("#email").val().toLowerCase();
        phoneNumber = $("#phone").val().toLowerCase();
        const pageChange = document.querySelector(".PatientHistoryPageChange");
        pageNum = pageChange.value;
        CallAjax();
    }

    function pageRecordChange() {
        pageNum = 1;
        firstname = $("#fname").val().toLowerCase();
        lastname = $("#lname").val().toLowerCase();
        email = $("#email").val().toLowerCase();
        phoneNumber = $("#phone").val().toLowerCase();

        const pageRecordChange = document.querySelector(".HistoryPageRecordChange").value;
        pageSize = pageRecordChange
        CallAjax();
    }

    function clearFilter() {
        pageNum = 1;
        pageSize = 5;
        firstname = "", lastname = "", email = "", phoneNumber = "";
        CallAjax();
    }

    function CallAjax() {
        sendAjaxRequest('/admin/records/PatientHistory', 'GET', { pageSize, pageNum, firstname, lastname, email, phoneNumber }, "application/x-www-form-urlencoded; charset=UTF-8", true)
            .then(function (response) {
                $("#patientHistory-render").empty();
                $("#patientHistory-render").html(response);
            }).catch(function (error) {
                ToastError("Internal Server Error");
            })
    }
</script>